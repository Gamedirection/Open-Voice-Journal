<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Open-Voice-Journal</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero">
        <div class="hero-row">
          <div class="hero-brand">
            <img id="brandLogo" class="brand-logo" alt="" hidden />
            <div>
            <h1>Open-Voice-Journal</h1>
            <p>Basic test app for web and Android APK validation.</p>
            <p id="projectVersion" class="hint">Version: loading...</p>
            </div>
          </div>
          <nav class="tab-bar">
            <button class="tab-button is-active" type="button" data-tab="record">Record</button>
            <button class="tab-button" type="button" data-tab="recordings">Recordings</button>
            <button class="tab-button" type="button" data-tab="settings">Settings</button>
          </nav>
        </div>
      </header>

      <section id="tab-record" class="tab-panel is-active">
        <div class="record-panel">
          <article class="card record-card">
            <h2>Record</h2>
            <input id="recordingTitle" placeholder="Recording title" />
            <div class="visualizer">
              <canvas id="recordVisualizer" width="640" height="120"></canvas>
            </div>
            <div class="record-controls">
              <button id="recordStart" class="record-button" type="button" aria-label="Start recording"></button>
              <button id="recordStop" class="stop-button" type="button" disabled>Save</button>
            </div>
            <p id="recordStatus">Ready to record.</p>
            <div id="liveCaptionsPanel" class="live-captions" aria-live="polite">
              <div id="liveCaptionsStatus" class="live-captions-status">Live captions: ready</div>
              <div id="liveCaptionsText" class="live-captions-text">Captions will appear here while recording.</div>
            </div>
            <p id="uploadStatus" class="hint">Uploads enabled by default.</p>
            <p class="hint">Microphone permission required on first use.</p>
          </article>
          <article class="card upload-card">
            <h2>Manual Upload</h2>
            <input id="manualTitle" placeholder="Upload title (optional)" />
            <input id="manualFile" type="file" accept="audio/*,.webm,.weba,.webp" />
            <div class="button-row">
              <button id="manualUpload" type="button">Upload File</button>
            </div>
            <p id="manualStatus" class="hint">Select an audio file to upload.</p>
          </article>
        </div>
      </section>

      <section id="tab-recordings" class="tab-panel">
        <article class="card">
          <div class="card-header">
            <h2>All Recordings</h2>
            <div class="recordings-header-actions">
              <div class="recordings-legend">
                <span class="legend-item">&#x2601;&#xFE0F; Cloud</span>
                <span class="legend-item">&#x1F3E0; Local</span>
              </div>
              <button id="refreshRecordings" type="button">Refresh</button>
            </div>
          </div>
          <input id="recordingsSearch" type="search" placeholder="Search titles, transcript text, or tags..." />
          <div id="recordingsList" class="recordings-list">No recordings yet.</div>
        </article>
      </section>

      <section id="tab-settings" class="tab-panel">
        <section class="card-grid">
          <article id="accountCard" class="card">
            <h2>Account</h2>
            <input id="authEmail" type="email" placeholder="Email" />
            <input id="authPassword" type="password" placeholder="Password" />
            <div id="authLoginRow" class="button-row">
              <button id="authLogin" type="button">Login</button>
            </div>
            <div id="authLogoutRow" class="button-row" hidden>
              <button id="authLogout" type="button">Logout</button>
            </div>
            <h3 class="subsection-title">Create Account</h3>
            <input id="authRegisterName" type="text" placeholder="Display name" />
            <input id="authRegisterEmail" type="email" placeholder="Email" />
            <input id="authRegisterPassword" type="password" placeholder="Password" />
            <button id="authRegister" type="button">Create Account</button>
            <div id="authChangePasswordGroup" hidden>
              <input id="authCurrentPassword" type="password" placeholder="Current password" />
              <input id="authNewPassword" type="password" placeholder="New password" />
              <button id="authChangePassword" type="button">Change Password</button>
            </div>
            <input id="authResetEmail" type="email" placeholder="Forgot password email" />
            <button id="authForgotPassword" type="button">Send Reset Link</button>
            <p id="authStatus" class="hint">Not logged in.</p>
            <h3 class="subsection-title">Select Server</h3>
            <input id="mobileApiBaseInput" placeholder="https://rec.gamedirection.net/api" />
            <div class="button-row">
              <button id="mobileSaveApiBase" type="button">Save Server</button>
              <button id="mobileUsePrompt" type="button">Set Custom URL</button>
            </div>
            <p id="mobileApiBaseStatus" class="hint">Server URL is saved on this device.</p>
          </article>

          <article id="generalSettingsCard" class="card">
            <h2>Settings</h2>
            <button id="themeToggle" class="toggle-button" type="button">Dark mode: Off</button>
            <button id="micEnable" class="ghost-button" type="button">Enable Microphone</button>
            <label class="switch-row">
              <span>Upload recordings automatically</span>
              <span class="switch">
                <input id="uploadToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <label class="switch-row">
              <span>Live captions while recording</span>
              <span class="switch">
                <input id="liveCaptionsToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <label class="switch-row">
              <span>Debug transcript timestamps</span>
              <span class="switch">
                <input id="debugTranscriptTimestampsToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <p class="hint">Turn this off to keep recordings local only.</p>
            <input
              id="deadAirThresholdSeconds"
              type="number"
              min="0.3"
              max="10"
              step="0.1"
              placeholder="Dead air threshold in seconds"
            />
            <button id="saveDeadAirThreshold" type="button">Save Dead Air Setting</button>
            <p id="deadAirThresholdStatus" class="hint">Silence runs above threshold will be removed.</p>
            <h3 class="subsection-title">Date & Time</h3>
            <input id="timeZoneInput" placeholder="Time zone (example: America/New_York)" />
            <div class="button-row">
              <button id="saveTimeZone" type="button">Save Time Zone</button>
              <button id="useSystemTimeZone" type="button">Use System Time Zone</button>
            </div>
            <p id="timeZoneStatus" class="hint">Using system time zone.</p>
          </article>

          <article id="automationCard" class="card">
            <h2>Automation & AI</h2>
            <label class="switch-row">
              <span>Auto transcribe after upload</span>
              <span class="switch">
                <input id="autoTranscribeToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <label class="switch-row">
              <span>Auto summarize after transcription</span>
              <span class="switch">
                <input id="autoSummarizeToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <label class="switch-row">
              <span>Identify unique voices in transcription</span>
              <span class="switch">
                <input id="identifyVoicesToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <input id="summaryProvider" placeholder="Summary provider (default: ollama_local)" />
            <input id="summaryModel" placeholder="Summary model (default: qwen2.5:7b-instruct)" />
            <input id="summaryApiKey" type="password" placeholder="Summary API key (optional)" />
            <textarea id="summaryPrompt" rows="6" placeholder="Summary prompt template"></textarea>
            <p class="hint">Default summary prompt:</p>
            <pre id="summaryPromptDefault" class="hint prompt-default"></pre>
            <div class="button-row">
              <button id="saveAiSettings" type="button">Save AI Settings</button>
              <button id="resetAiSettings" type="button">Restore Defaults</button>
            </div>
            <p id="aiSettingsStatus" class="hint">Default provider: local Ollama.</p>
          </article>

          <article id="apiConnectionsCard" class="card" hidden>
            <h2>API Connections</h2>
            <input id="apiBaseInput" placeholder="http://192.168.1.100:8080" />
            <button id="saveApiBase" type="button">Save API URL</button>
            <div class="button-row">
              <button id="useEmulator" type="button">Use Emulator 10.0.2.2</button>
              <button id="useLocalhost" type="button">Use Localhost</button>
              <button id="usePrompt" type="button">Set Custom URL</button>
            </div>
            <p id="apiBaseLabel">Using auto API URL.</p>
            <p id="apiStatus">Checking...</p>
            <button id="refreshHealth" type="button">Refresh</button>
            <h3 class="subsection-title">API Tools</h3>
            <input id="recordingId" placeholder="Paste recording ID" />
            <button id="createRecording" type="button">Create Test Recording</button>
            <button id="queueTranscription" type="button">Queue Job</button>
            <p id="recordingResult">No recording created yet.</p>
            <p id="jobResult">No job queued yet.</p>
            <h3 class="subsection-title">Open Signup</h3>
            <label class="switch-row">
              <span>Open signup enabled</span>
              <span class="switch">
                <input id="openSignupToggle" type="checkbox" />
                <span class="slider"></span>
              </span>
            </label>
            <button id="saveOpenSignup" type="button">Save Signup Setting</button>
            <p id="openSignupStatus" class="hint">Signup policy not loaded.</p>
            <h3 class="subsection-title">OpenAPI Keys</h3>
            <input id="openApiKeyName" placeholder="Key name (example: CI read access)" />
            <button id="createOpenApiKey" type="button">Create OpenAPI Key</button>
            <p id="openApiKeyCreateStatus" class="hint">Use header: X-OpenAPI-Key.</p>
            <div id="openApiKeyList" class="recordings-list">No OpenAPI keys yet.</div>
          </article>

          <article id="serverBackupCard" class="card" hidden>
            <h2>Server Backup</h2>
            <button id="createBackup" type="button">Backup Server Now</button>
            <p id="backupStatus" class="hint">Create a backup before deleting or restoring data.</p>
            <div id="backupList" class="recordings-list">No backups yet.</div>
          </article>

          <article id="adminUsersCard" class="card" hidden>
            <h2>Users & Data Governance</h2>
            <input id="adminUsersQuery" placeholder="Search email/name..." />
            <div class="recording-actions">
              <select id="adminUsersStatus">
                <option value="">All status</option>
                <option value="active">Active</option>
                <option value="blocked">Blocked</option>
              </select>
              <select id="adminUsersRole">
                <option value="">All roles</option>
                <option value="admin">Admin</option>
                <option value="user">User</option>
              </select>
              <select id="adminUsersSort">
                <option value="created_desc">Newest</option>
                <option value="storage_desc">Storage</option>
                <option value="activity_desc">Activity</option>
                <option value="recordings_desc">Recordings</option>
              </select>
              <button id="adminUsersRefresh" type="button">Refresh Users</button>
            </div>
            <div id="adminUsersStatusText" class="hint">Admin data not loaded.</div>
            <div class="table-scroll">
              <table class="admin-users-table">
                <thead>
                  <tr>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Storage</th>
                    <th>Recordings</th>
                    <th>Transcript</th>
                    <th>Summaries</th>
                    <th>Last Activity</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="adminUsersTableBody"></tbody>
              </table>
            </div>
          </article>

          <article id="docsCard" class="card">
            <h2>Documentation & Credits</h2>
            <p><a id="docsSwaggerLink" href="#" target="_blank" rel="noopener noreferrer">API Swagger</a></p>
            <p><a id="docsOpenApiLink" href="#" target="_blank" rel="noopener noreferrer">OpenAPI JSON</a></p>
            <p><a href="https://github.com/Gamedirection/Open-Voice-Journal/blob/main/README.md" target="_blank" rel="noopener noreferrer">README</a></p>
            <p><a href="https://github.com/Gamedirection/Open-Voice-Journal" target="_blank" rel="noopener noreferrer">GitHub Repository</a></p>
            <p>
              Alex Sierputowski @
              <a href="https://gamedirection.net" target="_blank" rel="noopener noreferrer">GameDirection.net</a>
            </p>
            <p>
              Contact:
              <a href="https://join.gamedirection.net" target="_blank" rel="noopener noreferrer">join.gamedirection.net</a>
            </p>
            <p id="docsVersion" class="hint">Version: loading...</p>
          </article>
        </section>
      </section>
    </main>

    <script src="script.js"></script>
  </body>
</html>
